# ============================================================================
# AC FIXBOT - Configuracion de Azure
# ============================================================================
# Copia este archivo a config.env y completa los valores
# IMPORTANTE: No subir config.env a git (ya esta en .gitignore)
# ============================================================================

# ----------------------------------------------------------------------------
# CONFIGURACION GENERAL
# ----------------------------------------------------------------------------
# ENVIRONMENT: dev (desarrollo), tst (testing cliente), prod (produccion cliente)
ENVIRONMENT="dev"

# Resource Group por ambiente
RESOURCE_GROUP="rg-acfixbot-${ENVIRONMENT}"
LOCATION="westus2"  # Washington - buena capacidad y todos los servicios

# ----------------------------------------------------------------------------
# SQL SERVER
# ----------------------------------------------------------------------------
SQL_SERVER_NAME="sql-acfixbot-${ENVIRONMENT}"
SQL_ADMIN_USER="acfixbotadmin"
# IMPORTANTE: Cambiar en produccion - minimo 12 caracteres, mayusculas, minusculas, numeros y simbolos
SQL_ADMIN_PASSWORD="CAMBIAR_EN_PRODUCCION"
SQL_DATABASE_NAME="db-acfixbot-${ENVIRONMENT}"
# SKU: Basic, S0, S1, S2, S3, P1, P2, P4, P6, P11, P15
SQL_SKU="Basic"

# ----------------------------------------------------------------------------
# STORAGE ACCOUNT
# ----------------------------------------------------------------------------
# Solo letras minusculas y numeros, 3-24 caracteres
STORAGE_ACCOUNT_NAME="stacfixbot${ENVIRONMENT}"
# SKU: Standard_LRS, Standard_GRS, Standard_RAGRS, Premium_LRS
STORAGE_SKU="Standard_LRS"

# ----------------------------------------------------------------------------
# FUNCTION APP
# ----------------------------------------------------------------------------
FUNCTION_APP_NAME="func-acfixbot-${ENVIRONMENT}"
# Runtime: node, python, dotnet, java
FUNCTION_RUNTIME="node"
FUNCTION_RUNTIME_VERSION="22"  # LTS - usar 22 o 24
# SKU del plan: Y1 (consumption), EP1, EP2, EP3 (premium), B1, B2, B3, S1, S2, S3 (app service)
FUNCTION_PLAN_SKU="Y1"

# ----------------------------------------------------------------------------
# COMPUTER VISION (OCR)
# ----------------------------------------------------------------------------
COMPUTER_VISION_NAME="cv-acfixbot-${ENVIRONMENT}"
# SKU: F0 (free), S1 (standard)
COMPUTER_VISION_SKU="S1"

# ----------------------------------------------------------------------------
# WHATSAPP BUSINESS API (Obtener de Meta Business)
# ----------------------------------------------------------------------------
WHATSAPP_TOKEN=""
WHATSAPP_PHONE_ID=""
WHATSAPP_VERIFY_TOKEN=""
# App Secret - Para verificar firma de webhooks (Settings > Basic > App Secret)
WHATSAPP_APP_SECRET=""

# ----------------------------------------------------------------------------
# CONFIGURACION DE IA
# ----------------------------------------------------------------------------
# Provider: 'gemini' para POC, 'azure-openai' para produccion
AI_PROVIDER="gemini"
USE_AI="true"

# Google Gemini (POC) - Obtener de Google AI Studio
GEMINI_API_KEY=""

# ----------------------------------------------------------------------------
# AZURE OPENAI (Produccion)
# ----------------------------------------------------------------------------
# Habilitar creacion automatica del recurso Azure OpenAI (true/false)
# NOTA: Requiere que tu suscripcion tenga acceso a Azure OpenAI
# Si no tienes acceso, solicitar en: https://aka.ms/oai/access
ENABLE_AZURE_OPENAI="false"

# Configuracion del recurso (si ENABLE_AZURE_OPENAI=true)
AZURE_OPENAI_NAME="aoai-acfixbot-${ENVIRONMENT}"
AZURE_OPENAI_LOCATION="eastus"  # Regiones: eastus, eastus2, westus, swedencentral
AZURE_OPENAI_MODEL="gpt-4o-mini"  # Modelos: gpt-4o, gpt-4o-mini, gpt-35-turbo
AZURE_OPENAI_DEPLOYMENT="gpt-4o-mini"  # Nombre del deployment

# Si ya tienes un recurso Azure OpenAI creado manualmente, configura aqui:
AZURE_OPENAI_ENDPOINT=""       # ej: https://mi-openai.openai.azure.com/
AZURE_OPENAI_KEY=""            # API Key del recurso

# ----------------------------------------------------------------------------
# TRANSCRIPCION DE AUDIO (Whisper en recurso separado)
# ----------------------------------------------------------------------------
# Habilitar transcripcion de mensajes de voz a texto
AUDIO_TRANSCRIPTION_ENABLED="false"  # true para habilitar

# Recurso de Azure OpenAI separado para Whisper
# Whisper solo está disponible en ciertas regiones (northcentralus, westeurope, swedencentral)
AZURE_WHISPER_NAME="aoai-acfixbot-whisper-${ENVIRONMENT}"
AZURE_WHISPER_LOCATION="northcentralus"  # North Central US tiene Whisper disponible
AZURE_AUDIO_DEPLOYMENT="whisper"

# ----------------------------------------------------------------------------
# CONFIGURACION DE SESIONES
# ----------------------------------------------------------------------------
SESSION_TIMEOUT_MINUTES="30"
SESSION_WARNING_MINUTES="25"

# ----------------------------------------------------------------------------
# CONFIGURACION DE ENCUESTAS DE SATISFACCION
# ----------------------------------------------------------------------------
# Schedule del timer (CRON): cuando ejecutar el envio de encuestas
# Formato: segundo minuto hora dia mes dia-semana
SURVEY_TIMER_SCHEDULE="0 0 9 * * *"  # 9:00 AM diario (produccion)
# SURVEY_TIMER_SCHEDULE="0 */5 * * * *"  # Cada 5 minutos (pruebas)

# Minutos de espera despues de resolucion antes de enviar encuesta
SURVEY_MINUTOS_ESPERA="1440"  # 1440 minutos = 24 horas (produccion)
# SURVEY_MINUTOS_ESPERA="1"  # 1 minuto (pruebas)

# Horas para expirar encuestas sin respuesta
SURVEY_HORAS_EXPIRACION="72"

# ----------------------------------------------------------------------------
# AZURE SPEECH SERVICES (Transcripcion de audio alternativa - GRATUITO)
# ----------------------------------------------------------------------------
# Azure Speech Services: 5 horas GRATIS de transcripcion por mes (tier F0)
# Es un fallback automatico cuando Azure Whisper falla o no esta disponible
# RECOMENDADO: Habilitar para tener transcripcion sin costos adicionales
ENABLE_AZURE_SPEECH="true"  # true para crear el recurso automaticamente

# Nombre y ubicacion del recurso (el script lo creara)
AZURE_SPEECH_NAME="speech-acfixbot-${ENVIRONMENT}"
AZURE_SPEECH_LOCATION="eastus"  # Regiones: eastus, westus2, southcentralus, etc.

# Si ya tienes un recurso Azure Speech creado manualmente, configura aqui:
# (Dejar vacio para que el script lo cree automaticamente)
AZURE_SPEECH_KEY=""
AZURE_SPEECH_REGION=""

# ----------------------------------------------------------------------------
# AZURE MAPS (Geocodificacion y rutas)
# ----------------------------------------------------------------------------
# API Key de Azure Maps - obtener de Azure Portal
AZURE_MAPS_KEY=""
# Minutos buffer para agregar al tiempo estimado de ruta (ej: trafico, imprevistos)
ROUTE_BUFFER_MINUTES="20"

# ----------------------------------------------------------------------------
# EASY AUTH (Azure AD Authentication para Dashboard)
# ----------------------------------------------------------------------------
# Habilitar autenticacion Azure AD para el dashboard de conversaciones
# Los usuarios deberan loguearse con su cuenta de Microsoft/Azure AD
ENABLE_EASY_AUTH="false"  # true para habilitar autenticacion

# Nombre de la App Registration en Azure AD (se crea automaticamente)
AAD_APP_NAME="AC FixBot Dashboard - ${ENVIRONMENT}"

# ----------------------------------------------------------------------------
# ALERTAS Y MONITOREO
# ----------------------------------------------------------------------------
# URL de webhook para recibir alertas críticas en Slack o Microsoft Teams
# El sistema envía alertas automáticas cuando:
# - Error rate supera 5% (warning) o 10% (critical)
# - SLA cae debajo de 95% (warning) o 90% (critical)
# - Latencia p95 supera thresholds configurados
# - Sistema reporta estado unhealthy/degraded
# - Memoria supera 80% (warning) o 90% (critical)
# - Dead Letter Queue supera 10 (warning) o 25 (critical) mensajes

# Slack: Obtener URL en https://api.slack.com/apps -> Incoming Webhooks
ALERT_WEBHOOK_URL=""
# Ejemplo Slack: "https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX"
# Ejemplo Teams: "https://outlook.office.com/webhook/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

# ============================================================================
# FASE 3 - ESCALABILIDAD (OPCIONAL)
# ============================================================================
# Habilitar solo cuando se necesite escalar a multiples instancias de Functions

# ----------------------------------------------------------------------------
# AZURE CACHE FOR REDIS
# ----------------------------------------------------------------------------
# Cache distribuido para sesiones - reemplaza cache en memoria local
# Necesario cuando hay multiples instancias de Azure Functions
ENABLE_REDIS="false"  # true para crear el recurso
REDIS_NAME="redis-acfixbot-${ENVIRONMENT}"
# SKU: Basic_C0, Basic_C1, Standard_C0, Standard_C1, Premium_P1
# Basic_C0: $16/mes, 250MB (suficiente para 100 reportes/dia)
REDIS_SKU="Basic"
REDIS_CAPACITY="0"  # 0=C0, 1=C1, etc.

# ----------------------------------------------------------------------------
# AZURE SERVICE BUS
# ----------------------------------------------------------------------------
# Dead Letter Queue distribuida - reemplaza tabla SQL para DLQ
# Permite procesamiento event-driven de mensajes fallidos
ENABLE_SERVICEBUS="false"  # true para crear el recurso
SERVICEBUS_NAMESPACE="sb-acfixbot-${ENVIRONMENT}"
# SKU: Basic, Standard, Premium
# Basic: $0.05/millon operaciones (suficiente para POC)
SERVICEBUS_SKU="Basic"
SERVICEBUS_QUEUE_NAME="acfixbot-messages"
